# VPS Deployment Script

This script (`deploy-vps.sh`) implements the SSH deployment requirements for deploying the Lumora stack to a Hostinger VPS.

## Usage

```bash
./deploy-vps.sh
```

## What it does

The script connects via SSH to `root@147.79.68.121` and performs these exact steps:

1. **Setup Directory**: Navigate to `/root/lumora-web` or clone the repository if it doesn't exist
2. **Update Repository**: Pull latest changes from main branch with `git fetch --all --prune && git checkout main && git pull --ff-only origin main`
3. **Create .env**: Generate `.env` file with IP mode configuration including auto-generated encryption key
4. **Fix Port Conflicts**: Stop any processes listening on ports 80/443 that are NOT docker traefik
5. **Deploy Containers**: Run `docker compose down --remove-orphans` then `docker compose up -d --build`
6. **Show Status**: Display container status and access URLs

## Requirements

- SSH key access to the VPS configured
- VPS has Docker and Docker Compose installed
- VPS has Git and OpenSSL installed

## Output

The script provides:
- Server IP address
- n8n access URL: `http://147.79.68.121:5678`
- Traefik dashboard URL: `http://147.79.68.121/`
- Container status information
- Service verification results

## Environment Configuration

The script creates a `.env` file with IP mode settings:

```
N8N_PORT=5678
GENERIC_TIMEZONE=Asia/Kolkata
TZ=Asia/Kolkata
N8N_PAYLOAD_SIZE_MAX=64
N8N_ENCRYPTION_KEY=<auto-generated-48-char-key>
DOMAIN=
LE_EMAIL=
```

## Testing

Use `test-deployment-logic.sh` to verify the deployment logic locally before running on the VPS.